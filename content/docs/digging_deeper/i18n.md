---
summary: å­¦ä¹ å¦‚ä½•ä½¿ç”¨ `@adonisjs/i18n` åŒ…åˆ›å»ºæ”¯æŒå¤šåœ°åŒºå’Œå¤šè¯­è¨€çš„Webåº”ç”¨ã€‚
---

# å›½é™…åŒ–ä¸æœ¬åœ°åŒ–

å›½é™…åŒ–ï¼ˆInternationalizationï¼‰å’Œæœ¬åœ°åŒ–ï¼ˆLocalizationï¼‰æ—¨åœ¨å¸®åŠ©ä½ åˆ›å»ºæ”¯æŒå¤šåœ°åŒºå’Œå¤šè¯­è¨€çš„Webåº”ç”¨ã€‚i18nï¼ˆInternationalizationçš„ç¼©å†™ï¼‰æ”¯æŒç”± `@adonisjs/i18n` åŒ…æä¾›ã€‚

- **æœ¬åœ°åŒ–** æ˜¯å°†åº”ç”¨ç¨‹åºæ–‡æœ¬ç¿»è¯‘ä¸ºå¤šç§è¯­è¨€çš„è¿‡ç¨‹ã€‚ä½ å¿…é¡»ä¸ºæ¯ç§è¯­è¨€ç¼–å†™æ–‡æœ¬å‰¯æœ¬ï¼Œå¹¶åœ¨Edgeæ¨¡æ¿ã€éªŒè¯é”™è¯¯æ¶ˆæ¯æˆ–ç›´æ¥ä½¿ç”¨ `i18n` APIä¸­å¼•ç”¨å®ƒä»¬ã€‚

- **å›½é™…åŒ–** æ˜¯æ ¹æ®ç‰¹å®šåœ°åŒºæˆ–å›½å®¶çš„æ ¼å¼æ ¼å¼åŒ–æ—¥æœŸã€æ—¶é—´ã€æ•°å­—ç­‰å€¼çš„è¿‡ç¨‹ã€‚

## å®‰è£…

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å¹¶é…ç½®è¯¥åŒ…ï¼š

```sh
node ace add @adonisjs/i18n
```

:::disclosure{title="æŸ¥çœ‹addå‘½ä»¤æ‰§è¡Œçš„æ­¥éª¤"}

1. ä½¿ç”¨æ£€æµ‹åˆ°çš„åŒ…ç®¡ç†å™¨å®‰è£… `@adonisjs/i18n` åŒ…ã€‚

2. åœ¨ `adonisrc.ts` æ–‡ä»¶ä¸­æ³¨å†Œä»¥ä¸‹æœåŠ¡æä¾›è€…ã€‚

   ```ts
   {
     providers: [
       // ...å…¶ä»–æä¾›è€…
       () => import('@adonisjs/i18n/i18n_provider'),
     ]
   }
   ```

3. åˆ›å»º `config/i18n.ts` æ–‡ä»¶ã€‚

4. åœ¨ `middleware` ç›®å½•ä¸­åˆ›å»º `detect_user_locale_middleware`ã€‚

5. åœ¨ `start/kernel.ts` æ–‡ä»¶ä¸­æ³¨å†Œä»¥ä¸‹ä¸­é—´ä»¶ã€‚

   ```ts
   router.use([() => import('#middleware/detect_user_locale_middleware')])
   ```

:::

## é…ç½®

å›½é™…åŒ–åŒ…çš„é…ç½®å­˜å‚¨åœ¨ `config/i18n.ts` æ–‡ä»¶ä¸­ã€‚

å¦è¯·å‚é˜…ï¼š[é…ç½®å­˜æ ¹](https://github.com/adonisjs/i18n/blob/main/stubs/config/i18n.stub)

```ts
import app from '@adonisjs/core/services/app'
import { defineConfig, formatters, loaders } from '@adonisjs/i18n'

const i18nConfig = defineConfig({
  defaultLocale: 'en',
  formatter: formatters.icu(),

  loaders: [
    loaders.fs({
      location: app.languageFilesPath(),
    }),
  ],
})

export default i18nConfig
```

<dl>

<dt>

formatter

</dt>

<dd>

å®šä¹‰ç”¨äºå­˜å‚¨ç¿»è¯‘çš„æ ¼å¼ã€‚AdonisJSæ”¯æŒ [ICUæ¶ˆæ¯æ ¼å¼](https://format-message.github.io/icu-message-format-for-translators/index.html)ã€‚

ICUæ¶ˆæ¯æ ¼å¼æ˜¯ä¸€ç§è¢«å¹¿æ³›æ¥å—çš„æ ‡å‡†ï¼Œè¢«è®¸å¤šç¿»è¯‘æœåŠ¡å¦‚Crowdinå’ŒLokaliseæ”¯æŒã€‚

æ­¤å¤–ï¼Œä½ å¯ä»¥ [æ·»åŠ è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼åŒ–å™¨](#creating-a-custom-translation-formatter)ã€‚

</dd>

<dt>

defaultLocale

</dt>

<dd>

åº”ç”¨ç¨‹åºçš„é»˜è®¤è¯­è¨€ç¯å¢ƒã€‚å½“åº”ç”¨ç¨‹åºä¸æ”¯æŒç”¨æˆ·è¯­è¨€æ—¶ï¼Œç¿»è¯‘å’Œå€¼æ ¼å¼åŒ–å°†å›é€€åˆ°è¯¥è¯­è¨€ç¯å¢ƒã€‚

</dd>

<dt id="config-fallback-locales">

fallbackLocales

</dt>

<dd>

å®šä¹‰è¯­è¨€ç¯å¢ƒåŠå…¶å›é€€è¯­è¨€ç¯å¢ƒçš„é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ”¯æŒè¥¿ç­ç‰™è¯­ï¼Œä½ å¯ä»¥å°†å…¶å®šä¹‰ä¸ºåŠ æ³°ç½—å°¼äºšè¯­çš„å›é€€ã€‚

```ts
export default defineConfig({
  formatter: formatters.icu(),
  defaultLocale: 'en',
  // highlight-start
  fallbackLocales: {
    ca: 'es', // å½“ç”¨æˆ·è¯´åŠ æ³°ç½—å°¼äºšè¯­æ—¶æ˜¾ç¤ºè¥¿ç­ç‰™è¯­å†…å®¹
  },
  // highlight-end
})
```

</dd>

<dt>

supportedLocales

</dt>

<dd>

åº”ç”¨ç¨‹åºæ”¯æŒçš„è¯­è¨€ç¯å¢ƒæ•°ç»„ã€‚

```ts
export default defineConfig({
  formatter: formatters.icu(),
  defaultLocale: 'en',
  // highlight-start
  supportedLocales: ['en', 'fr', 'it'],
  // highlight-end
})
```

å¦‚æœä½ ä¸å®šä¹‰æ­¤å€¼ï¼Œæˆ‘ä»¬å°†ä»ç¿»è¯‘ä¸­æ¨æ–­ `supportedLocales`ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰äº†è‹±è¯­ã€æ³•è¯­å’Œè¥¿ç­ç‰™è¯­çš„ç¿»è¯‘ï¼Œ`supportedLocales` çš„å€¼å°†ä¸º `['en', 'es', 'fr']`

</dd>

<dt>

loaders

</dt>

<dd>

ç”¨äºåŠ è½½ç¿»è¯‘çš„åŠ è½½å™¨é›†åˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæ”¯æŒæ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ [æ·»åŠ è‡ªå®šä¹‰åŠ è½½å™¨](#creating-a-custom-translation-loader)ã€‚

</dd>

</dl>

## å­˜å‚¨ç¿»è¯‘

ç¿»è¯‘å­˜å‚¨åœ¨ `resources/lang` ç›®å½•ä¸­ï¼Œä½ å¿…é¡»æ ¹æ® [IETFè¯­è¨€æ ‡ç­¾](https://en.wikipedia.org/wiki/IETF_language_tag) æ ¼å¼ä¸ºæ¯ç§è¯­è¨€åˆ›å»ºä¸€ä¸ªå­ç›®å½•ã€‚ä¾‹å¦‚ï¼š

```
resources
â”œâ”€â”€ lang
â”‚   â”œâ”€â”€ en
â”‚   â””â”€â”€ fr
```

ä½ å¯ä»¥é€šè¿‡åˆ›å»ºå¸¦æœ‰åœ°åŒºä»£ç çš„å­ç›®å½•æ¥å®šä¹‰ç‰¹å®šåœ°åŒºçš„ç¿»è¯‘ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸º **è‹±è¯­ï¼ˆå…¨å±€ï¼‰ã€è‹±è¯­ï¼ˆç¾å›½ï¼‰** å’Œ **è‹±è¯­ï¼ˆè‹±å›½ï¼‰**å®šä¹‰äº†ä¸åŒçš„ç¿»è¯‘ã€‚

å½“ä½ åœ¨åœ°åŒºç‰¹å®šçš„ç¿»è¯‘é›†ä¸­ç¼ºå°‘ç¿»è¯‘æ—¶ï¼ŒAdonisJSå°†è‡ªåŠ¨å›é€€åˆ°**è‹±è¯­ï¼ˆå…¨å±€ï¼‰**ã€‚

å¦è¯·å‚é˜…ï¼š[ISOè¯­è¨€ä»£ç ](https://www.andiamo.co.uk/resources/iso-language-codes/)

```
resources
â”œâ”€â”€ lang
â”‚   â”œâ”€â”€ en
â”‚   â”œâ”€â”€ en-us
â”‚   â”œâ”€â”€ en-uk

```

### æ–‡ä»¶æ ¼å¼

ç¿»è¯‘å¿…é¡»å­˜å‚¨åœ¨ `.json` æˆ– `.yaml` æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºåµŒå¥—ç›®å½•ç»“æ„ä»¥è·å¾—æ›´å¥½çš„ç»„ç»‡ã€‚

```
resources
â”œâ”€â”€ lang
â”‚   â”œâ”€â”€ en
â”‚   â”‚   â””â”€â”€ messages.json
â”‚   â””â”€â”€ fr
â”‚       â””â”€â”€ messages.json

```

ç¿»è¯‘å¿…é¡»æŒ‰ç…§ [ICUæ¶ˆæ¯è¯­æ³•](https://format-message.github.io/icu-message-format-for-translators/index.html) è¿›è¡Œæ ¼å¼åŒ–ã€‚

```json
// title: resources/lang/en/messages.json
{
  "greeting": "Hello world"
}
```

```json
// title: resources/lang/fr/messages.json
{
  "greeting": "Bonjour le monde"
}
```

## è§£æç¿»è¯‘

åœ¨æŸ¥æ‰¾å’Œæ ¼å¼åŒ–ç¿»è¯‘ä¹‹å‰ï¼Œä½ éœ€è¦ä½¿ç”¨ `i18nManager.locale` æ–¹æ³•åˆ›å»º [I18nç±»](https://github.com/adonisjs/i18n/blob/main/src/i18n.ts) çš„ç‰¹å®šè¯­è¨€ç¯å¢ƒå®ä¾‹ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

// è‹±è¯­çš„I18nå®ä¾‹
const en = i18nManager.locale('en')

// æ³•è¯­çš„I18nå®ä¾‹
const fr = i18nManager.locale('fr')
```

ä¸€æ—¦ä½ æœ‰äº† `I18n` ç±»çš„å®ä¾‹ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ `.t` æ–¹æ³•æ¥æ ¼å¼åŒ–ç¿»è¯‘ã€‚

```ts
const i18n = i18nManager.locale('en')
i18n.t('messages.greeting') // Hello world
```

```ts
const i18n = i18nManager.locale('fr')
i18n.t('messages.greeting') // Bonjour le monde
```

### å›é€€è¯­è¨€ç¯å¢ƒ

æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªåŸºäº [config.fallbackLocales](#config-fallback-locales) é›†åˆé¢„é…ç½®çš„å›é€€è¯­è¨€ã€‚å½“ä¸»è¦è¯­è¨€ç¼ºå°‘ç¿»è¯‘æ—¶ï¼Œå°†ä½¿ç”¨å›é€€è¯­è¨€ã€‚

```ts
export default defineConfig({
  fallbackLocales: {
    'de-CH': 'de',
    'fr-CH': 'fr',
  },
})
```

```ts
const i18n = i18nManager.locale('de-CH')
i18n.fallbackLocale // de (ä½¿ç”¨å›é€€é›†åˆ)
```

```ts
const i18n = i18nManager.locale('fr-CH')
i18n.fallbackLocale // fr (ä½¿ç”¨å›é€€é›†åˆ)
```

```ts
const i18n = i18nManager.locale('en')
i18n.fallbackLocale // en (ä½¿ç”¨é»˜è®¤è¯­è¨€ç¯å¢ƒ)
```

### ç¼ºå¤±çš„ç¿»è¯‘

å¦‚æœä¸»è¦è¯­è¨€ç¯å¢ƒå’Œå›é€€è¯­è¨€ç¯å¢ƒä¸­éƒ½ç¼ºå°‘ç¿»è¯‘ï¼Œ`.t` æ–¹æ³•å°†è¿”å›å¦‚ä¸‹æ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸²ã€‚

```ts
const i18n = i18nManager.locale('en')

i18n.t('messages.hero_title')
// translation missing: en, messages.hero_title
```

ä½ å¯ä»¥é€šè¿‡å°†å›é€€å€¼å®šä¹‰ä¸ºç¬¬äºŒä¸ªå‚æ•°æ¥æ›¿æ¢æ­¤æ¶ˆæ¯ä¸ºä¸åŒçš„æ¶ˆæ¯æˆ–ç©ºå­—ç¬¦ä¸²ã€‚

```ts
const fallbackValue = ''
i18n.t('messages.hero_title', fallbackValue)
// è¾“å‡º: ''
```

ä½ è¿˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å…¨å±€è®¡ç®—å›é€€å€¼ã€‚`fallback` æ–¹æ³•æ¥æ”¶ç¿»è¯‘è·¯å¾„ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯­è¨€ç¯å¢ƒä»£ç ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ç¡®ä¿å§‹ç»ˆè¿”å›å­—ç¬¦ä¸²å€¼ã€‚

```ts
import { defineConfig } from '@adonisjs/i18n'

export default defineConfig({
  fallback: (identifier, locale) => {
    return ''
  },
})
```

## åœ¨HTTPè¯·æ±‚æœŸé—´æ£€æµ‹ç”¨æˆ·è¯­è¨€ç¯å¢ƒ

åœ¨åˆå§‹è®¾ç½®æœŸé—´ï¼Œæˆ‘ä»¬åœ¨ `./app/middleware` ç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ª `detect_user_locale_middleware.ts` æ–‡ä»¶ã€‚è¯¥ä¸­é—´ä»¶æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- ä½¿ç”¨ [`Accept-language` å¤´](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language) æ£€æµ‹è¯·æ±‚çš„è¯­è¨€ç¯å¢ƒã€‚

- ä¸ºè¯·æ±‚è¯­è¨€ç¯å¢ƒåˆ›å»º `I18n` ç±»çš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ [HTTPä¸Šä¸‹æ–‡](../concepts/http_context.md) ä¸è¯·æ±‚ç®¡é“çš„å…¶ä½™éƒ¨åˆ†å…±äº«ã€‚

- å°†ç›¸åŒçš„å®ä¾‹ä½œä¸ºå…¨å±€ `i18n` å±æ€§ä¸Edgeæ¨¡æ¿å…±äº«ã€‚

- æœ€åï¼ŒæŒ‚é’©åˆ° [è¯·æ±‚éªŒè¯å™¨](../basics/validation.md#the-requestvalidateusing-method) å¹¶ä½¿ç”¨ç¿»è¯‘æ–‡ä»¶æä¾›éªŒè¯æ¶ˆæ¯ã€‚

å¦‚æœæ­¤ä¸­é—´ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨æ§åˆ¶å™¨å’ŒEdgeæ¨¡æ¿ä¸­ç¿»è¯‘æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```ts
import { HttpContext } from '@adonisjs/core/http'

export default class PostsController {
  async store({ i18n, session }: HttpContext) {
    session.flash('success', {
      message: i18n.t('post.created'),
    })
  }
}
```

```edge
<h1> {{ t('messages.heroTitle') }} </h1>
```

### æ›´æ”¹ç”¨æˆ·è¯­è¨€æ£€æµ‹ä»£ç 

ç”±äº `detect_user_locale_middleware` æ˜¯åº”ç”¨ç¨‹åºä»£ç åº“çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥ä¿®æ”¹ `getRequestLocale` æ–¹æ³•å¹¶ä½¿ç”¨è‡ªå®šä¹‰é€»è¾‘æŸ¥æ‰¾ç”¨æˆ·è¯­è¨€ã€‚

## ç¿»è¯‘éªŒè¯æ¶ˆæ¯

`detect_user_locale_middleware` æŒ‚é’©åˆ° [è¯·æ±‚éªŒè¯å™¨](../basics/validation.md#the-requestvalidateusing-method) å¹¶ä½¿ç”¨ç¿»è¯‘æ–‡ä»¶æä¾›éªŒè¯æ¶ˆæ¯ã€‚

```ts
export default class DetectUserLocaleMiddleware {
  static {
    // highlight-start
    RequestValidator.messagesProvider = (ctx) => {
      return ctx.i18n.createMessagesProvider()
    }
    // highlight-end
  }
}
```

ç¿»è¯‘å¿…é¡»å­˜å‚¨åœ¨ `validator.json` æ–‡ä»¶çš„ `shared` é”®ä¸‹ã€‚éªŒè¯æ¶ˆæ¯å¯ä»¥ä¸ºéªŒè¯è§„åˆ™æˆ– `å­—æ®µ+è§„åˆ™` ç»„åˆå®šä¹‰ã€‚

```json
// title: resources/lang/en/validator.json
{
  "shared": {
    "fields": {
      "first_name": "first name"
    },
    "messages": {
      "required": "Enter {field}",
      "username.required": "Choose a username for your account",
      "email": "The email must be valid"
    }
  }
}
```

```json
// title: resources/lang/fr/validator.json
{
  "shared": {
    "fields": {
      "first_name": "PrÃ©nom"
    },
    "messages": {
      "required": "Remplisser le champ {field}",
      "username.required": "Choissisez un nom d'utilisateur pour votre compte",
      "email": "L'email doit Ãªtre valide"
    }
  }
}
```

### ç›´æ¥ä¸VineJSä¸€èµ·ä½¿ç”¨ç¿»è¯‘

åœ¨HTTPè¯·æ±‚æœŸé—´ï¼Œ`detect_user_locale_middleware` æŒ‚é’©åˆ°è¯·æ±‚éªŒè¯å™¨å¹¶æ³¨å†Œä¸€ä¸ª [è‡ªå®šä¹‰æ¶ˆæ¯æä¾›ç¨‹åº](https://vinejs.dev/docs/custom_error_messages#registering-messages-provider) æ¥ä»ç¿»è¯‘æ–‡ä»¶ä¸­æŸ¥æ‰¾éªŒè¯é”™è¯¯ã€‚

ä½†æ˜¯ï¼Œå¦‚æœåœ¨HTTPè¯·æ±‚ä¹‹å¤–ä½¿ç”¨VineJSï¼Œå¦‚åœ¨Aceå‘½ä»¤æˆ–é˜Ÿåˆ—ä½œä¸šä¸­ï¼Œä½ å¿…é¡»åœ¨è°ƒç”¨ `validator.validate` æ–¹æ³•æ—¶æ˜¾å¼æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯æä¾›ç¨‹åºã€‚

```ts
import { createJobValidator } from '#validators/jobs'
import i18nManager from '@adonisjs/i18n/services/main'

/**
 * è·å–ç‰¹å®šè¯­è¨€ç¯å¢ƒçš„i18nå®ä¾‹
 */
const i18n = i18nManager.locale('fr')

await createJobValidator.validate(data, {
  /**
   * æ³¨å†Œæ¶ˆæ¯æä¾›ç¨‹åºä»¥ä½¿ç”¨ç¿»è¯‘
   */
  // highlight-start
  messagesProvider: i18n.createMessagesProvider(),
  // highlight-end
})
```

## ICUæ¶ˆæ¯æ ¼å¼

### æ’å€¼

ICUæ¶ˆæ¯è¯­æ³•ä½¿ç”¨å•ä¸ªèŠ±æ‹¬å·æ¥å¼•ç”¨åŠ¨æ€å€¼ã€‚ä¾‹å¦‚ï¼š

:::note
ICUæ¶ˆæ¯è¯­æ³• [ä¸æ”¯æŒåµŒå¥—æ•°æ®é›†](https://github.com/formatjs/formatjs/pull/2039#issuecomment-951550150)ï¼Œå› æ­¤åœ¨æ’å€¼æœŸé—´ä½ åªèƒ½è®¿é—®æ‰å¹³å¯¹è±¡çš„å±æ€§ã€‚
:::

```json
{
  "greeting": "Hello { username }"
}
```

```edge
{{ t('messages.greeting', { username: 'Virk' }) }}
```

ä½ ä¹Ÿå¯ä»¥åœ¨æ¶ˆæ¯ä¸­ç¼–å†™HTMLã€‚ä½†æ˜¯ï¼Œåœ¨Edgeæ¨¡æ¿ä¸­ä½¿ç”¨ä¸‰ä¸ª [èŠ±æ‹¬å·](https://edgejs.dev/docs/interpolation#escaped-html-output) æ¥æ¸²æŸ“HTMLè€Œä¸è½¬ä¹‰å®ƒã€‚

```json
{
  "greeting": "<p> Hello { username } </p>"
}
```

```edge
{{{ t('messages.greeting', { username: 'Virk' }) }}}
```

### æ•°å­—æ ¼å¼

ä½ å¯ä»¥ä½¿ç”¨ `{key, type, format}` è¯­æ³•åœ¨ç¿»è¯‘æ¶ˆæ¯ä¸­æ ¼å¼åŒ–æ•°å€¼ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š

- `amount` æ˜¯è¿è¡Œæ—¶å€¼ã€‚
- `number` æ˜¯æ ¼å¼åŒ–ç±»å‹ã€‚
- `::currency/USD` æ˜¯å¸¦æœ‰ [æ•°å­—éª¨æ¶](https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#overview) çš„è´§å¸æ ¼å¼ã€‚

```json
{
  "bagel_price": "The price of this bagel is {amount, number, ::currency/USD}"
}
```

```edge
{{ t('bagel_price', { amount: 2.49 }) }}
```

```
è¿™ä¸ªç™¾å‰é¥¼çš„ä»·æ ¼æ˜¯ $2.49

```

ä»¥ä¸‹æ˜¯ä½¿ç”¨å…·æœ‰ä¸åŒæ ¼å¼åŒ–æ ·å¼å’Œæ•°å­—éª¨æ¶çš„ `number` æ ¼å¼çš„ç¤ºä¾‹ï¼š

### æ—¥æœŸ/æ—¶é—´æ ¼å¼

ä½ å¯ä»¥ä½¿ç”¨ `{key, type, format}` è¯­æ³•æ ¼å¼åŒ– [Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date) å®ä¾‹æˆ– [luxon DateTime](https://moment.github.io/luxon/api-docs/index.html) å®ä¾‹ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š

- `expectedDate` æ˜¯è¿è¡Œæ—¶å€¼ã€‚
- `date` æ˜¯æ ¼å¼åŒ–ç±»å‹ã€‚
- `medium` æ˜¯æ—¥æœŸæ ¼å¼ã€‚

```json
{
  "shipment_update": "Your package will arrive on {expectedDate, date, medium}"
}
```

```edge
{{ t('shipment_update', { expectedDate: luxonDateTime }) }}
```

```
æ‚¨çš„åŒ…è£¹å°†äº2023å¹´10æœˆ16æ—¥é€è¾¾ã€‚
```

ä½ å¯ä»¥ä½¿ç”¨ `time` æ ¼å¼å°†å€¼æ ¼å¼åŒ–ä¸ºæ—¶é—´ï¼š

```json
{
  "appointment": "You have an appointment today at {appointmentAt, time, ::h:m a}"
}
```

```txt
You have an appointment today at 2:48 PM
```

ICUæä¾›äº† [å¤šç§æ¨¡å¼](https://unicode-org.github.io/icu/userguide/format_parse/datetime/#date-field-symbol-table) æ¥è‡ªå®šä¹‰æ—¥æœŸæ—¶é—´æ ¼å¼ã€‚ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰è¿™äº›æ¨¡å¼éƒ½å¯ä»¥é€šè¿‡ECMA402çš„Intl APIä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªæ”¯æŒä»¥ä¸‹æ¨¡å¼ï¼š

| ç¬¦å· | æè¿°                             |
| ---- | -------------------------------- |
| `G`  | çºªå…ƒæŒ‡ç¤ºç¬¦                       |
| `y`  | å¹´ä»½                             |
| `M`  | å¹´ä»½ä¸­çš„æœˆä»½                     |
| `L`  | ç‹¬ç«‹çš„å¹´ä»½ä¸­çš„æœˆä»½               |
| `d`  | æœˆä»½ä¸­çš„æ—¥æœŸ                     |
| `E`  | æ˜ŸæœŸå‡                            |
| `e`  | æœ¬åœ°æ˜ŸæœŸå‡ ï¼ˆä¸æ”¯æŒe..eeeï¼‰       |
| `c`  | ç‹¬ç«‹çš„æœ¬åœ°æ˜ŸæœŸå‡ ï¼ˆä¸æ”¯æŒc..cccï¼‰ |
| `a`  | AM/PMæ ‡è®°                        |
| `h`  | å°æ—¶ [1-12]                      |
| `H`  | å°æ—¶ [0-23]                      |
| `K`  | å°æ—¶ [0-11]                      |
| `k`  | å°æ—¶ [1-24]                      |
| `m`  | åˆ†é’Ÿ                             |
| `s`  | ç§’                               |
| `z`  | æ—¶åŒº                             |

### å¤æ•°è§„åˆ™

ICUæ¶ˆæ¯è¯­æ³•å¯¹åœ¨æ¶ˆæ¯ä¸­å®šä¹‰å¤æ•°è§„åˆ™æä¾›äº†ä¸€æµçš„æ”¯æŒã€‚ä¾‹å¦‚ï¼š

:::note

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨YAMLè€Œä¸æ˜¯JSONï¼Œå› ä¸ºåœ¨YAMLä¸­ç¼–å†™å¤šè¡Œæ–‡æœ¬æ›´å®¹æ˜“ã€‚

:::

```yaml
cart_summary: 'You have {itemsCount, plural,
  =0 {no items}
  one {1 item}
  other {# items}
  } in your cart'
```

```edge
{{ t('messages.cart_summary', { itemsCount: 1 }) }}
```

```
æ‚¨çš„è´­ç‰©è½¦ä¸­æœ‰ 1 ä»¶å•†å“
```

`#` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä»¤ç‰Œï¼Œç”¨ä½œæ•°å€¼çš„å ä½ç¬¦ã€‚å®ƒå°†è¢«æ ¼å¼åŒ–ä¸º `{key, number}`ã€‚

```edge
{{ t('messages.cart_summary', { itemsCount: 1000 }) }}

{{-- è¾“å‡º --}}
{{-- You have 1,000 items in your cart --}}
```

å¤æ•°è§„åˆ™ä½¿ç”¨ `{key, plural, matches}` è¯­æ³•ã€‚`matches` æ˜¯ä¸€ä¸ªå­—é¢é‡å€¼ï¼Œä¸ä»¥ä¸‹å¤æ•°ç±»åˆ«ä¹‹ä¸€åŒ¹é…ï¼š

| ç±»åˆ«     | æè¿°                                                                                                                                   |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `zero`   | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•ä¸“é—¨é’ˆå¯¹é›¶æ•°é‡é¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­å’Œæ‹‰è„±ç»´äºšè¯­ï¼‰                                                                   |
| `one`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹ä¸€ä¸ªé¡¹ç›®çš„è¯­è¨€ã€‚è®¸å¤šè¯­è¨€ï¼Œä½†ä¸æ˜¯æ‰€æœ‰è¯­è¨€ï¼Œéƒ½ä½¿ç”¨æ­¤å¤æ•°ç±»åˆ«ã€‚ï¼ˆè®¸å¤šæµè¡Œçš„äºšæ´²è¯­è¨€ï¼Œå¦‚ä¸­æ–‡å’Œæ—¥è¯­ï¼Œä¸ä½¿ç”¨æ­¤ç±»åˆ«ã€‚ï¼‰ |
| `two`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹ä¸¤ä¸ªé¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­å’Œå¨å°”å£«è¯­ï¼‰                                                                       |
| `few`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹å°‘é‡é¡¹ç›®çš„è¯­è¨€ã€‚å¯¹äºæŸäº›è¯­è¨€ï¼Œè¿™ç”¨äº2-4ä¸ªé¡¹ç›®ï¼Œå¯¹äºæŸäº›è¯­è¨€ç”¨äº3-10ä¸ªé¡¹ç›®ï¼Œè€Œå…¶ä»–è¯­è¨€æœ‰æ›´å¤æ‚çš„è§„åˆ™ã€‚            |
| `many`   | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•é’ˆå¯¹å¤§é‡é¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­ã€æ³¢å…°è¯­å’Œä¿„è¯­ï¼‰                                                                       |
| `other`  | å¦‚æœå€¼ä¸å…¶ä»–å¤æ•°ç±»åˆ«ä¸åŒ¹é…ï¼Œåˆ™ä½¿ç”¨æ­¤ç±»åˆ«ã€‚è¯·æ³¨æ„ï¼Œè¿™ç”¨äºå…·æœ‰ç®€å•"å•æ•°"ä¸"å¤æ•°"äºŒåˆ†æ³•çš„è¯­è¨€ï¼ˆå¦‚è‹±è¯­ï¼‰çš„"å¤æ•°"ã€‚                         |
| `=value` | æ— è®ºå½“å‰è¯­è¨€ç¯å¢ƒçš„å¤æ•°ç±»åˆ«å¦‚ä½•ï¼Œè¿™éƒ½ç”¨äºåŒ¹é…ç‰¹å®šå€¼ã€‚                                                                                   |

> _è¡¨æ ¼å†…å®¹å‚è€ƒè‡ª [formatjs.io](https://formatjs.io/docs/core-concepts/icu-syntax/#plural-format)_

### é€‰æ‹©

`select` æ ¼å¼å…è®¸ä½ é€šè¿‡å°†å€¼ä¸å¤šä¸ªé€‰é¡¹ä¹‹ä¸€åŒ¹é…æ¥é€‰æ‹©è¾“å‡ºã€‚ç¼–å†™æ€§åˆ«ç‰¹å®šæ–‡æœ¬æ˜¯ `select` æ ¼å¼çš„ç»ä½³ç¤ºä¾‹ï¼š

```yaml
// title: Yaml
auto_reply: '{gender, select,
  male {He}
  female {She}
  other {They}
  } will respond shortly.'
```

```edge
{{ t('messages.auto_reply', { gender: 'female' }) }}
```

```
å¥¹ç¨åä¼šå›å¤ã€‚

```

### é€‰æ‹©åºæ•°

`select ordinal` æ ¼å¼å…è®¸ä½ æ ¹æ®åºæ•°å¤æ•°è§„åˆ™é€‰æ‹©è¾“å‡ºã€‚è¯¥æ ¼å¼ä¸ `select` æ ¼å¼ç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œè¯¥å€¼æ˜ å°„åˆ°åºæ•°å¤æ•°ç±»åˆ«ï¼š

```yaml
anniversary_greeting: "It's my {years, selectordinal,
  one {#st}
  two {#nd}
  few {#rd}
  other {#th}
  } anniversary"
```

```edge
{{ t('messages.anniversary_greeting', { years: 2 }) }}
```

```txt
It's my 2nd anniversary
```

select ordinal æ ¼å¼ä½¿ç”¨ `{key, selectordinal, matches}` è¯­æ³•ã€‚match æ˜¯ä¸€ä¸ªå­—é¢é‡å€¼ï¼Œä¸ä»¥ä¸‹å¤æ•°ç±»åˆ«ä¹‹ä¸€åŒ¹é…ï¼š

| ç±»åˆ«     | æè¿°                                                                                                                                   |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `zero`   | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•ä¸“é—¨é’ˆå¯¹é›¶æ•°é‡é¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­å’Œæ‹‰è„±ç»´äºšè¯­ï¼‰                                                                   |
| `one`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹ä¸€ä¸ªé¡¹ç›®çš„è¯­è¨€ã€‚è®¸å¤šè¯­è¨€ï¼Œä½†ä¸æ˜¯æ‰€æœ‰è¯­è¨€ï¼Œéƒ½ä½¿ç”¨æ­¤å¤æ•°ç±»åˆ«ã€‚ï¼ˆè®¸å¤šæµè¡Œçš„äºšæ´²è¯­è¨€ï¼Œå¦‚ä¸­æ–‡å’Œæ—¥è¯­ï¼Œä¸ä½¿ç”¨æ­¤ç±»åˆ«ã€‚ï¼‰ |
| `two`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹ä¸¤ä¸ªé¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­å’Œå¨å°”å£«è¯­ï¼‰                                                                       |
| `few`    | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•æ˜ç¡®é’ˆå¯¹å°‘é‡é¡¹ç›®çš„è¯­è¨€ã€‚å¯¹äºæŸäº›è¯­è¨€ï¼Œè¿™ç”¨äº2-4ä¸ªé¡¹ç›®ï¼Œå¯¹äºæŸäº›è¯­è¨€ç”¨äº3-10ä¸ªé¡¹ç›®ï¼Œè€Œå…¶ä»–è¯­è¨€æœ‰æ›´å¤æ‚çš„è§„åˆ™ã€‚            |
| `many`   | æ­¤ç±»åˆ«ç”¨äºè¯­æ³•é’ˆå¯¹å¤§é‡é¡¹ç›®çš„è¯­è¨€ã€‚ï¼ˆä¾‹å¦‚é˜¿æ‹‰ä¼¯è¯­ã€æ³¢å…°è¯­å’Œä¿„è¯­ï¼‰                                                                       |
| `other`  | å¦‚æœå€¼ä¸å…¶ä»–å¤æ•°ç±»åˆ«ä¸åŒ¹é…ï¼Œåˆ™ä½¿ç”¨æ­¤ç±»åˆ«ã€‚è¯·æ³¨æ„ï¼Œè¿™ç”¨äºå…·æœ‰ç®€å•"å•æ•°"ä¸"å¤æ•°"äºŒåˆ†æ³•çš„è¯­è¨€ï¼ˆå¦‚è‹±è¯­ï¼‰çš„"å¤æ•°"ã€‚                         |
| `=value` | æ— è®ºå½“å‰è¯­è¨€ç¯å¢ƒçš„å¤æ•°ç±»åˆ«å¦‚ä½•ï¼Œè¿™éƒ½ç”¨äºåŒ¹é…ç‰¹å®šå€¼ã€‚                                                                                   |

> _è¡¨æ ¼å†…å®¹å‚è€ƒè‡ª [formatjs.io](https://formatjs.io/docs/core-concepts/icu-syntax/#selectordinal-format)_

## æ ¼å¼åŒ–å€¼

ä»¥ä¸‹æ–¹æ³•åœ¨å†…éƒ¨ä½¿ç”¨ [Node.js Intl API](https://nodejs.org/dist/latest/docs/api/intl.html)ï¼Œä½†å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚[æŸ¥çœ‹åŸºå‡†æµ‹è¯•](https://github.com/poppinss/intl-formatter?tab=readme-ov-file#benchmarks)

### formatNumber

ä½¿ç”¨ `Intl.NumberFormat` ç±»æ ¼å¼åŒ–æ•°å€¼ã€‚ä½ å¯ä»¥ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š

1. è¦æ ¼å¼åŒ–çš„å€¼ã€‚
2. å¯é€‰çš„ [`options` å¯¹è±¡](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat#options)ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatNumber(123456.789, {
  maximumSignificantDigits: 3,
})
```

### formatCurrency

ä½¿ç”¨ `Intl.NumberFormat` ç±»å°†æ•°å€¼æ ¼å¼åŒ–ä¸ºè´§å¸ã€‚`formatCurrency` æ–¹æ³•éšå¼å®šä¹‰äº† `style = currency` é€‰é¡¹ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatCurrency(200, {
  currency: 'USD',
})
```

### formatDate

ä½¿ç”¨ `Intl.DateTimeFormat` ç±»æ ¼å¼åŒ–æ—¥æœŸæˆ–luxonæ—¥æœŸæ—¶é—´å¯¹è±¡ã€‚ä½ å¯ä»¥ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š

1. è¦æ ¼å¼åŒ–çš„å€¼ã€‚å®ƒå¯ä»¥æ˜¯ [Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date) å¯¹è±¡æˆ– [luxon DateTime](https://moment.github.io/luxon/api-docs/index.html) å¯¹è±¡ã€‚
2. å¯é€‰çš„ [`options` å¯¹è±¡](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat#options)ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'
import { DateTime } from 'luxon'

i18nManager.locale('en').formatDate(new Date(), {
  dateStyle: 'long',
})

// æ ¼å¼åŒ–luxonæ—¥æœŸæ—¶é—´å®ä¾‹
i18nManager.locale('en').formatDate(DateTime.local(), {
  dateStyle: 'long',
})
```

### formatTime

ä½¿ç”¨ `Intl.DateTimeFormat` ç±»å°†æ—¥æœŸå€¼æ ¼å¼åŒ–ä¸ºæ—¶é—´å­—ç¬¦ä¸²ã€‚`formatTime` æ–¹æ³•éšå¼å®šä¹‰äº† `timeStyle = medium` é€‰é¡¹ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatTime(new Date())
```

### formatRelativeTime

`formatRelativeTime` æ–¹æ³•ä½¿ç”¨ `Intl.RelativeTimeFormat` ç±»å°†å€¼æ ¼å¼åŒ–ä¸ºç›¸å¯¹æ—¶é—´è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•æ¥å—ä»¥ä¸‹å‚æ•°ï¼š

- è¦æ ¼å¼åŒ–çš„å€¼ã€‚
- æ ¼å¼åŒ–å•ä½ã€‚é™¤äº† [å®˜æ–¹æ”¯æŒçš„å•ä½](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat/format)ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒä¸€ä¸ªé¢å¤–çš„ `auto` å•ä½ã€‚
- å¯é€‰çš„ [options](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat/RelativeTimeFormat#options) å¯¹è±¡ã€‚

```ts
import { DateTime } from 'luxon'
import i18nManager from '@adonisjs/i18n/services/main'

const luxonDate = DateTime.local().plus({ hours: 2 })

i18nManager.locale('en').formatRelativeTime(luxonDate, 'hours')
```

å°†å•ä½çš„å€¼è®¾ç½®ä¸º `auto` ä»¥ä»¥æœ€ä½³åŒ¹é…å•ä½æ˜¾ç¤ºå·®å¼‚ï¼š

```ts
const luxonDate = DateTime.local().plus({ hours: 2 })

I18n.locale('en').formatRelativeTime(luxonDate, 'auto')

// In 2 hours ğŸ‘ˆ
```

```ts
const luxonDate = DateTime.local().plus({ hours: 200 })

I18n.locale('en').formatRelativeTime(luxonDate, 'auto')

// In 8 days ğŸ‘ˆ
```

### formatPlural

ä½¿ç”¨ `Intl.PluralRules` ç±»æŸ¥æ‰¾æ•°å­—çš„å¤æ•°ç±»åˆ«ã€‚ä½ å¯ä»¥ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š

1. è¦æŸ¥æ‰¾å¤æ•°ç±»åˆ«çš„æ•°å€¼ã€‚
2. å¯é€‰çš„ [options](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/PluralRules/PluralRules#options) å¯¹è±¡ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.i18nManager('en').formatPlural(0)
// other

i18nManager.i18nManager('en').formatPlural(1)
// one

i18nManager.i18nManager('en').formatPlural(2)
// other
```

### formatList

ä½¿ç”¨ `Intl.ListFormat` ç±»å°†å­—ç¬¦ä¸²æ•°ç»„æ ¼å¼åŒ–ä¸ºå¥å­ã€‚ä½ å¯ä»¥ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š

1. è¦æ ¼å¼åŒ–çš„å€¼ã€‚
2. å¯é€‰çš„ [options](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/ListFormat/ListFormat#options) å¯¹è±¡ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager
  .locale('en')
  .formatList(['Me', 'myself', 'I'], { type: 'conjunction' })

// Me, myself and I
```

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatList(['5 hours', '3 minutes'], { type: 'unit' })

// 5 hours, 3 minutes
```

### formatDisplayNames

ä½¿ç”¨ `Intl.DisplayNames` ç±»å°†è´§å¸ã€è¯­è¨€ã€åœ°åŒºå’Œæ—¥å†ä»£ç æ ¼å¼åŒ–ä¸ºå…¶æ˜¾ç¤ºåç§°ã€‚ä½ å¯ä»¥ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š

1. è¦æ ¼å¼åŒ–çš„ä»£ç ã€‚`code` çš„ [å€¼å› ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DisplayNames/of#code) æ ¼å¼åŒ–çš„ `type` è€Œå¼‚ã€‚
2. [Options](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DisplayNames/DisplayNames#options) å¯¹è±¡ã€‚

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatDisplayNames('INR', { type: 'currency' })

// Indian Rupee
```

```ts
import i18nManager from '@adonisjs/i18n/services/main'

i18nManager.locale('en').formatDisplayNames('en-US', { type: 'language' })

// American English
```

## é…ç½®i18n Ally VSCodeæ‰©å±•

VSCodeçš„ [i18n Ally](https://marketplace.visualstudio.com/items?itemName=Lokalise.i18n-ally) æ‰©å±•ä¸ºåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­å­˜å‚¨ã€æ£€æŸ¥å’Œå¼•ç”¨ç¿»è¯‘æä¾›äº†å‡ºè‰²çš„å·¥ä½œæµç¨‹ã€‚

ä¸ºäº†ä½¿è¯¥æ‰©å±•ä¸AdonisJSæ— ç¼åä½œï¼Œä½ å¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `.vscode` ç›®å½•ä¸­åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

```sh
mkdir .vscode

touch .vscode/i18n-ally-custom-framework.yml
touch .vscode/settings.json
```

å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶/ç²˜è´´åˆ° `settings.json` æ–‡ä»¶ä¸­ï¼š

```json
// title: .vscode/settings.json
{
  "i18n-ally.localesPaths": ["resources/lang"],
  "i18n-ally.keystyle": "nested",
  "i18n-ally.namespace": true,
  "i18n-ally.editor.preferEditor": true,
  "i18n-ally.refactor.templates": [
    {
      "templates": ["{{ t('{key}'{args}) }}"],
      "include": ["**/*.edge"]
    }
  ]
}
```

å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶/ç²˜è´´åˆ° `.vscode/i18n-ally-custom-framework.yml` æ–‡ä»¶ä¸­ï¼š

```yaml
// title: .vscode/i18n-ally-custom-framework.yml
languageIds:
  - edge
usageMatchRegex:
  - "[^\\w\\d]t\(['\"`]({key})['\"`]"
sortKeys: true
```

## ç›‘å¬ç¼ºå¤±ç¿»è¯‘äº‹ä»¶

ä½ å¯ä»¥ç›‘å¬ `i18n:missing:translation` äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºä¸­æ”¶åˆ°å…³äºç¼ºå¤±ç¿»è¯‘çš„é€šçŸ¥ï¼š

```ts
import emitter from '@adonisjs/core/services/emitter'

emitter.on('i18n:missing:translation', function (event) {
  console.log(event.identifier)
  console.log(event.hasFallback)
  console.log(event.locale)
})
```

## å¼ºåˆ¶é‡æ–°åŠ è½½ç¿»è¯‘

`@adonisjs/i18n` åŒ…åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶è¯»å–ç¿»è¯‘æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨å†…å­˜ä¸­ä»¥ä¾¿å¿«é€Ÿè®¿é—®ã€‚

ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä¿®æ”¹ç¿»è¯‘æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `reloadTranslations` æ–¹æ³•åˆ·æ–°å†…å­˜ç¼“å­˜ï¼š

```ts
import i18nManager from '@adonisjs/i18n/services/main'

await i18nManager.reloadTranslations()
```

## åˆ›å»ºè‡ªå®šä¹‰ç¿»è¯‘åŠ è½½å™¨

ç¿»è¯‘åŠ è½½å™¨è´Ÿè´£ä»æŒä¹…å­˜å‚¨åŠ è½½ç¿»è¯‘ã€‚æˆ‘ä»¬æä¾›äº†æ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨ï¼Œå¹¶æä¾›äº†æ³¨å†Œè‡ªå®šä¹‰åŠ è½½å™¨çš„APIã€‚

åŠ è½½å™¨å¿…é¡»å®ç° [TranslationsLoaderContract](https://github.com/adonisjs/i18n/blob/main/src/types.ts#L73) æ¥å£ï¼Œå¹¶å®šä¹‰ `load` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªé”®å€¼å¯¹å¯¹è±¡ã€‚é”®æ˜¯è¯­è¨€ç¯å¢ƒä»£ç ï¼Œå€¼æ˜¯åŒ…å«ç¿»è¯‘åˆ—è¡¨çš„æ‰å¹³å¯¹è±¡ã€‚

```ts
import type {
  LoaderFactory,
  TranslationsLoaderContract,
} from '@adonisjs/i18n/types'

/**
 * é…ç½®ç±»å‹
 */
export type DbLoaderConfig = {
  connection: string
  tableName: string
}

/**
 * åŠ è½½å™¨å®ç°
 */
export class DbLoader implements TranslationsLoaderContract {
  constructor(public config: DbLoaderConfig) {}

  async load() {
    return {
      en: {
        'messages.greeting': 'Hello world',
      },
      fr: {
        'messages.greeting': 'Bonjour le monde',
      },
    }
  }
}

/**
 * å·¥å‚å‡½æ•°ï¼Œç”¨äºåœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨åŠ è½½å™¨
 */
export function dbLoader(config: DbLoaderConfig): LoaderFactory {
  return () => {
    return new DbLoader(config)
  }
}
```

åœ¨ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¼å‡ºä»¥ä¸‹å€¼ï¼š

- `DbLoaderConfig`ï¼šä½ æƒ³è¦æ¥å—çš„é…ç½®çš„TypeScriptç±»å‹ã€‚
- `DbLoader`ï¼šåŠ è½½å™¨çš„å®ç°ç±»ã€‚å®ƒå¿…é¡»éµå¾ª `TranslationsLoaderContract` æ¥å£ã€‚
- `dbLoader`ï¼šæœ€åï¼Œä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨äºåœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨åŠ è½½å™¨ã€‚

### ä½¿ç”¨åŠ è½½å™¨

ä¸€æ—¦åˆ›å»ºäº†åŠ è½½å™¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ `dbLoader` å·¥å‚å‡½æ•°åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨å®ƒï¼š

```ts
import { defineConfig } from '@adonisjs/i18n'
import { dbLoader } from 'my-custom-package'

const i18nConfig = defineConfig({
  loaders: [
    dbLoader({
      connection: 'pg',
      tableName: 'translations',
    }),
  ],
})
```

## åˆ›å»ºè‡ªå®šä¹‰ç¿»è¯‘æ ¼å¼åŒ–å™¨

ç¿»è¯‘æ ¼å¼åŒ–å™¨è´Ÿè´£æ ¹æ®ç‰¹å®šæ ¼å¼æ ¼å¼åŒ–ç¿»è¯‘ã€‚æˆ‘ä»¬æä¾›äº†ICUæ¶ˆæ¯è¯­æ³•çš„å®ç°ï¼Œå¹¶æä¾›äº†é¢å¤–çš„APIæ¥æ³¨å†Œè‡ªå®šä¹‰æ ¼å¼åŒ–å™¨ã€‚

æ ¼å¼åŒ–å™¨å¿…é¡»å®ç° [TranslationsFormatterContract](https://github.com/adonisjs/i18n/blob/main/src/types.ts#L54) æ¥å£ï¼Œå¹¶å®šä¹‰ `format` æ–¹æ³•æ¥æ ¼å¼åŒ–ç¿»è¯‘æ¶ˆæ¯ã€‚

```ts
import type {
  FormatterFactory,
  TranslationsLoaderContract,
} from '@adonisjs/i18n/types'

/**
 * æ ¼å¼åŒ–å™¨å®ç°
 */
export class FluentFormatter implements TranslationsFormatterContract {
  format(message: string, locale: string, data?: Record<string, any>): string {
    // è¿”å›æ ¼å¼åŒ–åçš„å€¼
  }
}

/**
 * å·¥å‚å‡½æ•°ï¼Œç”¨äºåœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨æ ¼å¼åŒ–å™¨
 */
export function fluentFormatter(): FormatterFactory {
  return () => {
    return new FluentFormatter()
  }
}
```

### ä½¿ç”¨æ ¼å¼åŒ–å™¨

ä¸€æ—¦åˆ›å»ºäº†æ ¼å¼åŒ–å™¨ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ `fluentFormatter` å·¥å‚å‡½æ•°åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨å®ƒï¼š

```ts
import { defineConfig } from '@adonisjs/i18n'
import { fluentFormatter } from 'my-custom-package'

const i18nConfig = defineConfig({
  formatter: fluentFormatter(),
})
```
